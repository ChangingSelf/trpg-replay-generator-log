# trpg-replay-generator-log README

这是一个辅助扩展，用于跑团replay视频制作程序“回声工坊”的log文件的语法高亮，并且根据该软件的文档添加了一些代码片段

[软件“回声工坊”的介绍视频](https://www.bilibili.com/video/BV1GY4y1H7wK/)

[软件“回声工坊”的Github仓库](https://github.com/DanDDXuanX/TRPG-Replay-Generator)

## 使用方法

详细使用方法可见视频：[适用于回声工坊的vscode扩展插件介绍](https://www.bilibili.com/video/BV1yt4y1p7xa/)

- 安装该扩展之后在弹窗中使用该扩展提供的“rgl theme”（不用自带主题的话可能高亮起来怪怪的，当然，可以切换其他主题，同样有语法高亮）
- 将要高亮的文件的扩展名改为.rgl，txt文件是不会高亮的

## 支持的代码片段

- 内建动画行：支持`<dice>`和`<hitpoint>`的快速输入。例如：输入dice4可以快速输入含有4组参数的骰子行，输入hp可以快速输入生命值行
- 设置行：输入set可以在弹出的列表中选择需要输入的设置
- 背景行：输入background + 切换方式的名称或者bg+切换方式开头字母就可以快速输入背景行。例如`bgr`或`background replace`为`<background><replace=0>:背景媒体`
- 音效框：输入audio可以快速输入音效框，即`{音效;*时间}`
- 便于复制使用的常用正则表达式片段：触发词前缀是regex。分别是“将跑团记录着色器得到的尖括号替换为方括号与冒号”，“批量给对话行末尾添加待处理星标“{*}”。”，“给某个特定角色对话行末尾加特定音效。”

## 代码折叠

- 在想要折叠的起始行和末尾行分别加上`#s`和`#e`的注释，即可对中间的内容进行折叠
- 可以嵌套，而且这两个边界标记后面可以加注释，例如`#s 这是折叠的起始行，意思是start`，`#e 这是折叠的末尾行，意思是end`。

## 命令

命令的使用方法是：ctrl+alt+p唤出命令面板，输入命令名字，enter键确认


### `RGL Count`

可以统计对话行和骰子行的行数，并将rgl文件中提到的所有角色和背景不重复地列出，方便填写角色配置表和定义背景媒体，同时可以估算生成的视频的时间。

### `Define Media`

根据指定路径内的媒体素材生成媒体定义文件。

例子：把所有的素材分类放在`F:/demo`路径下，它的目录结构（所有目录都是可选的）是：

- demo
  - Animation
    - KP
      - 差分1.png
      - 差分2.png
    - PC1
      - 微笑.png
      - 哭泣.png
    - PC2
      - 愤怒.png
      - 悲伤.png
    - NPC1.png
    - NPC2.png
  - Audio
    - 掷骰音效.wav
    - 掷骰成功音效.wav
    - 掷骰失败音效.wav
  - Background
    - 图书馆
      - 一楼
      - 二楼
    - 研究所
      - 门口
      - 研究室
  - BGM
    - 懒得编了.ogg
    - 就当这里有很多BGM吧.ogg
  - Bubble
    - bubble1.png
    - bubble2.png
  - Text
    - 字体文件1.otf
  - StrokeText
    - 字体文件2.otf

输入命令后，会弹出一个输入框，让你输入媒体素材所在的文件夹的路径，本例子中是：“F:/demo”。

接着会弹出第二个输入框，让你输入媒体定义文件的路径（含文件名），你可以直接按下回车键使用默认值“./media.txt”，即，在“F:/demo”目录下生成一个“media.txt”文件。

接下来会扫描“F:/demo”文件夹，若存在特定媒体文件夹，就根据这个文件夹内的媒体文件生成对应的条目。

每一个媒体文件夹都是可选的，例如“F:/demo”可以只有“Background”文件夹，这时候只会处理这个文件夹。

媒体文件夹内可以嵌套多层文件夹，例如：

- Animation
    - PC1
      - 微笑.png
      - 哭泣.png
    - NPC1.png
    - NPC2.png

生成的媒体名字将会是：PC1_微笑，PC1_哭泣，NPC1，NPC2

更深层的嵌套以此类推，一般用不到，这里也不举例了。

由于文件夹名有可能作为媒体名前缀，所以请不要用奇怪的符号命名文件夹。

**当媒体文件名不合法时，会直接跳过该文件。**(但如果加上前缀就合法，还是会处理该文件，所以看到文件里面有奇怪前缀的文件名可能是这种情况)

该命令生成的媒体定义文件使用的都是默认值，气泡和立绘的位置仍然需要手动去回声工坊的图形界面调整。

用回声工坊的图形界面编辑器打开时，会报出一些“解析错误”，但是不用理，那是由于它不支持解析其中的注释行和空白行，在图形界面编辑器中保存一次就好了。

当然，如果大家都不喜欢自动生成的注释，我下个版本会取消保留注释。